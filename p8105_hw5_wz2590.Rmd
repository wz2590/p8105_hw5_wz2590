---
title: "p8105_hw5_wz2590"
author: "Weiheng Zhang"
date: "2021/11/11"
output: github_document
---

```{r message = FALSE}
library(tidyverse)
library(dplyr)
library(p8105.datasets)

knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%"
)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_color_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```


## Problem 2

```{r}
filenames = 
  tibble(filename = list.files("./data/Problem2"))
```


```{r}
longitudinal_df = 
  filenames %>% 
  mutate(
    filename = str_c("data/Problem2/", filename),
    data = map(.x = filename, ~read_csv(.x))) %>% 
  separate(filename, c(NA, NA,"name"), sep = "/") %>% 
  separate(name, c("Arm","Subject_ID", NA)) %>% 
  mutate(Arm = recode(Arm, con = "Control", exp = "Experiment")) %>% 
  unnest(data)
longitudinal_df
```

```{r}
#convert to long format for graphing
longitudinal_long = longitudinal_df %>% 
  pivot_longer(week_1:week_8,
               names_prefix = "week_",
               names_to = "Week",
               values_to = "Observation") %>% 
  mutate(Week = as.numeric(Week))

longitudinal_long
```


```{r, dpi=300}
Experiment_plot = 
  longitudinal_long %>% 
  filter(Arm == "Experiment") %>% 
  ggplot(aes(x = Week, y = Observation, group = Subject_ID, color = Subject_ID)) +
  geom_line(size = 0.8) + 
  geom_point() +
  labs(
    title = "Observations on Experiment Subjects Over Time",
    x = "Weeks",
    y = "Observation"
  ) + 
  scale_color_hue(name = "Subject ID")

Control_plot = 
  longitudinal_long %>% 
  filter(Arm == "Control") %>% 
  ggplot(aes(x = Week, y = Observation, group = Subject_ID, color = Subject_ID)) +
  geom_line(size = 0.8) + 
  geom_point() +
  labs(
    title = "Observations on Control Subjects Over Time",
    x = "Weeks",
    y = "Observation"
  ) + 
  scale_color_hue(name = "Subject ID")

Experiment_plot
Control_plot
```
Generally, the observations of each subject in the experimental group increases over time, While subjects in the control group does not show any association between time and observation. Observations of subjects in the experimental group are also consistently higher than observations of subjects in the control group, during the study period.  
  
  
## Problem 3
```{r}
set.seed(10)

iris_with_missing = iris %>% 
  map_df(~replace(.x, sample(1:150, 20), NA)) %>%
  mutate(Species = as.character(Species))
iris_with_missing
```














